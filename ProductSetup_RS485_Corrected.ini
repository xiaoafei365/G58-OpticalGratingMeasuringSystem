# 光栅测量系统配置文件 - RS485通讯修正版
# 根据RS485-MODBUS通讯地址文档修正

[FrontOrBack]
setval = 1

[RoundDisplay]
roundtimeinterval = 180
residencetimeaftermeasurement = 180
readslavetimeinterval = 200
gratingsendandrecvtimeinterval = 0

# RS485通讯配置 (根据文档修正)
[COM]
port = COM3
baudrate = 9600
timeout = 1.0
debug = 1
presenddelay = 10
prereceivedelay = 10
# RS485-MODBUS通讯参数
data_bits = 8
stop_bits = 1
parity = None
protocol = RS485
format = RTU
address_format = 16进制格式

# 设备配置 (根据文档修正地址)
[G45_48]
slaveaddress = 1
unitaddress = 0x1000
unitcount = 2
description = 当前值寄存器

[SST]
slaveaddress = 2
unitaddress = 0x1000
unitcount = 2
description = 当前值寄存器

[C2C1B2B1]
slaveaddress = 3
unitaddress = 0x1000
unitcount = 8
description = 当前值寄存器

# 光栅通道配置 (使用正确的寄存器地址)
[Channel_1LeftGrating]
slaveaddress = 11
regaddress = 0x1000
regcount = 2
description = 通道1左侧光栅 - 当前值寄存器 (RAH:高位字节, RAL:低位字节)

[Channel_1RightGrating]
slaveaddress = 21
regaddress = 0x1000
regcount = 2
description = 通道1右侧光栅 - 当前值寄存器 (RAH:高位字节, RAL:低位字节)

[Channel_2LeftGrating]
slaveaddress = 12
regaddress = 0x1000
regcount = 2
description = 通道2左侧光栅 - 当前值寄存器 (RAH:高位字节, RAL:低位字节)

[Channel_2RightGrating]
slaveaddress = 22
regaddress = 0x1000
regcount = 2
description = 通道2右侧光栅 - 当前值寄存器 (RAH:高位字节, RAL:低位字节)

[Channel_3LeftGrating]
slaveaddress = 13
regaddress = 0x1000
regcount = 2
description = 通道3左侧光栅 - 当前值寄存器 (RAH:高位字节, RAL:低位字节)

[Channel_3RightGrating]
slaveaddress = 23
regaddress = 0x1000
regcount = 2
description = 通道3右侧光栅 - 当前值寄存器 (RAH:高位字节, RAL:低位字节)

[Channel_4LeftGrating]
slaveaddress = 14
regaddress = 0x1000
regcount = 2
description = 通道4左侧光栅 - 当前值寄存器 (RAH:高位字节, RAL:低位字节)

[Channel_4RightGrating]
slaveaddress = 24
regaddress = 0x1000
regcount = 2
description = 通道4右侧光栅 - 当前值寄存器 (RAH:高位字节, RAL:低位字节)

[Channel_5LeftGrating]
slaveaddress = 15
regaddress = 0x1000
regcount = 2
description = 通道5左侧光栅 - 当前值寄存器 (RAH:高位字节, RAL:低位字节)

[Channel_5RightGrating]
slaveaddress = 25
regaddress = 0x1000
regcount = 2
description = 通道5右侧光栅 - 当前值寄存器 (RAH:高位字节, RAL:低位字节)

# 扩展寄存器配置 (根据文档添加)
[ScaleFactor]
# 比例系数寄存器
slaveaddress = 1
regaddress = 0x1002
regcount = 2
description = 比例系数寄存器 (范围: 1~29999, 对应0.0001~2.9999)

[EnvelopeDiameter]
# 包络直径寄存器
slaveaddress = 1
regaddress = 0x1004
regcount = 2
description = 包络直径寄存器 (范围: 1~40000mm)

[MultiCompensation]
# 多段补偿值寄存器
slaveaddress = 1
regaddress = 0x1006
regcount = 2
description = 多段补偿值寄存器 (范围: 0~9000mm)

[MeasurementDirection]
# 测量方向寄存器
slaveaddress = 1
regaddress = 0x2000
regcount = 1
description = 测量方向寄存器 (范围: 0~1)

[SelfCalibration]
# 自校正寄存器
slaveaddress = 1
regaddress = 0x2001
regcount = 1
description = 自校正寄存器

# 主机写<16位寄存器>命令配置
[WriteRegisterCommand]
# 寄存器地址
reg_address_addr = 0x2002
# 寄存器个数
reg_count_addr = 0x2003
# 写字节数
write_bytes_addr = 0x2004
# 寄存器数值
reg_value_addr = 0x2005

# 功能说明配置
[RegisterFunctions]
# 读取功能 (功能码0x03)
read_holding_registers = 0x03
# 写入功能 (功能码0x06, 0x10)
write_single_register = 0x06
write_multiple_registers = 0x10

# 通讯参数说明
[CommunicationSpecs]
protocol = RS485两线制通讯，ModBus RTU协议
data_format = 8位数据位，无校验，1位停止位
address_format = 16进制格式
baud_rates = 4800bps~57600bps
default_baud = 9600

# 寄存器地址范围说明
[AddressRanges]
current_value = 0x1000 (当前值, 范围: 99999~-99999)
scale_factor = 0x1002 (比例系数, 范围: 1~29999)
envelope_diameter = 0x1004 (包络直径, 范围: 1~40000mm)
multi_compensation = 0x1006 (多段补偿值, 范围: 0~9000mm)
measurement_direction = 0x2000 (测量方向, 范围: 0~1)
self_calibration = 0x2001 (自校正)
function_selection = 0x2002 (功能选择, 范围: 0~2)
resolution = 0x2003 (分辨率, 范围: 0~2)
display_function = 0x2004 (显示功能, 范围: 0~3)
baudrate_setting = 0x2005 (从机号, 范围: 0~255)
wave_filter = 0x2006 (波特率, 范围: 4800bps~57600bps)
factory_reset = 0x2007 (数据备份恢复, 范围: 0~3)
backup_restore = 0x2008 (保存出厂设置, 范围: 0~1)
multi_compensation_enable = 0x2009 (多段补偿修正, 范围: 0~2)
error_bit_settings = 0x200B (错误位设置)

# Modbus TCP设备配置 (如果需要)
[ModbusTCP]
device_count = 1
device_1_ip = 192.168.0.10
device_1_port = 502
device_1_name = C2000-A2-SDD8020-B83
timeout = 5

[Version]
current = G58
available = G45,G58,G75
rs485_protocol_version = 1.0
modbus_rtu_version = standard

[Database]
server = localhost
database = GratingMeasurement
trusted_connection = yes
