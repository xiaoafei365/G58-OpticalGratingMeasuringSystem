# 光学光栅测量系统 - 试用期管理功能

## 功能概述

本系统新增了试用期管理功能，软件运行时开始计时，当累计运行30天后，系统将无法使用，并提示试用期到期，需要输入验证码解锁系统。

## 功能特性

### 1. 试用期计时
- 软件首次运行时自动开始计时
- 试用期为30天
- 系统会自动保存试用期信息，重启后仍然有效

### 2. 验证码系统
系统支持两种类型的验证码：

#### 延期验证码（10个）
- `EXTEND2025A1`
- `EXTEND2025B2`
- `EXTEND2025C3`
- `EXTEND2025D4`
- `EXTEND2025E5`
- `EXTEND2025F6`
- `EXTEND2025G7`
- `EXTEND2025H8`
- `EXTEND2025I9`
- `EXTEND2025J0`

**特点：**
- 每个验证码可延长试用期30天
- 每个验证码只能使用一次
- 使用后会被标记为已使用，无法重复使用

#### 解锁验证码（1个）
- `UNLOCK2025FOREVER`

**特点：**
- 输入后永久解锁系统
- 解锁后无任何使用限制
- 系统状态会被永久保存

### 3. 系统锁定机制
- 试用期到期后，系统自动锁定
- 锁定状态下无法启动测量功能
- 访问主页时会自动跳转到验证码输入页面
- 只有输入有效验证码才能解锁系统

## 用户界面

### 试用期管理页面
- 显示当前试用期状态
- 提供验证码输入界面
- 实时反馈验证结果
- 自动跳转功能

### 状态显示
- 试用期剩余天数
- 已使用天数
- 系统锁定状态
- 验证码使用历史

## 技术实现

### 核心类：TrialManager
```python
class TrialManager:
    def __init__(self, trial_file="trial_info.dat")
    def get_trial_status(self) -> Dict
    def is_system_locked(self) -> bool
    def verify_code(self, code: str) -> Dict
```

### 数据存储
- 使用pickle格式存储试用期信息
- 文件名：`trial_info.dat`
- 包含：开始时间、已使用验证码、解锁状态

### Web API接口
- `GET /api/trial_status` - 获取试用期状态
- `POST /api/verify_code` - 验证验证码
- `GET /trial` - 试用期管理页面

## 使用说明

### 1. 首次运行
- 系统自动开始30天试用期
- 在主界面可以正常使用所有功能

### 2. 试用期内
- 系统显示剩余天数
- 可以提前输入延期验证码延长使用期限
- 所有功能正常可用

### 3. 试用期到期
- 系统自动锁定，无法启动测量
- 访问主页时跳转到验证码输入页面
- 必须输入有效验证码才能继续使用

### 4. 验证码使用
- 在验证码输入框中输入验证码
- 点击"验证并解锁系统"按钮
- 系统会实时反馈验证结果

## 安全特性

### 1. 防篡改
- 试用期信息使用二进制格式存储
- 包含时间戳验证
- 防止简单的文件修改

### 2. 验证码保护
- 验证码使用一次性机制
- 已使用的验证码会被记录
- 防止重复使用

### 3. 系统集成
- 与主程序深度集成
- 在关键功能入口进行检查
- 确保试用期限制的有效性

## 测试功能

### 测试脚本
提供了测试脚本用于验证功能：
- `test_trial_system.py` - 完整功能测试
- `simple_trial_test.py` - 简化测试版本

### 测试内容
- 初始状态检查
- 延期验证码测试
- 重复使用验证码测试
- 无效验证码测试
- 解锁验证码测试
- 过期状态模拟

## 故障排除

### 1. 试用期信息丢失
如果`trial_info.dat`文件丢失，系统会：
- 自动重新开始30天试用期
- 重置所有验证码使用状态
- 记录新的开始时间

### 2. 验证码无效
可能原因：
- 验证码输入错误（注意大小写）
- 验证码已被使用过
- 验证码不在预定义列表中

### 3. 系统无法解锁
检查项目：
- 确认验证码输入正确
- 检查网络连接
- 查看浏览器控制台错误信息

## 维护说明

### 1. 验证码管理
- 延期验证码可以根据需要修改
- 解锁验证码建议定期更换
- 验证码应保密管理

### 2. 试用期调整
- 可以修改`trial_days`参数调整试用期长度
- 延期天数可以在`verify_code`方法中调整

### 3. 数据备份
- 建议定期备份`trial_info.dat`文件
- 可以用于恢复试用期状态

## 注意事项

1. **时间同步**：确保系统时间准确，避免试用期计算错误
2. **文件权限**：确保程序有权限读写`trial_info.dat`文件
3. **验证码保密**：验证码应妥善保管，避免泄露
4. **备份重要**：建议备份试用期数据文件
5. **测试环境**：在生产环境部署前充分测试

## 联系支持

如需获取验证码或遇到技术问题，请联系技术支持团队。
